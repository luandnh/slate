<h1 id='event'>Event</h1><h2 id='get-events'>Get Events</h2><div class="highlight"><pre class="highlight shell tab-shell"><code>curl <span class="nt">-L</span> <span class="nt">-X</span> GET <span class="s1">'https://{{API_HOST}}/v1/event'</span> <span class="se">\</span>
<span class="nt">-H</span> <span class="s1">'Authorization: Bearer {{TOKEN}}'</span>
</code></pre></div>
<blockquote>
<p>Response trả về:</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nl">"event_domain_uuid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"avavavav-1111-2222-3333-eeeeeeee"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"domain_uuid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"dddddddd-1111-2222-3333-eeeeeeee"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"domain_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"test.tel4vn.com"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"event_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"hangup"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"callback_url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://webhook.demo/"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"callback_apikey"</span><span class="p">:</span><span class="w"> </span><span class="s2">"foo"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="err">...</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>
<p>Trả về các call events của tenant.</p>
<h3 id='http-request'>HTTP Request</h3>
<p><code>GET https://{{API_HOST}}/v1/event</code></p>
<h2 id='create-events'>Create Events</h2><div class="highlight"><pre class="highlight shell tab-shell"><code>curl <span class="nt">-L</span> <span class="nt">-X</span> POST <span class="s1">'https://{{API_HOST}}/v1/event'</span> <span class="se">\</span>
<span class="nt">-H</span> <span class="s1">'Authorization: Bearer {{TOKEN}}'</span> <span class="se">\</span>
<span class="nt">-H</span> <span class="s1">'Content-Type: application/json'</span> <span class="se">\</span>
<span class="nt">--data-raw</span> <span class="s1">'{
    "callback_url" : "https://webhook.demo/",
    "callback_apikey" : "foo",
    "event" : "create"
}'</span>
</code></pre></div>
<blockquote>
<p>Response trả về:</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"created"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>
<p>Tạo Event Hook, mỗi lần bắt được {event} tổng đài sẽ hook dữ liệu về {callback_url}.</p>
<h3 id='http-request-2'>HTTP Request</h3>
<p><code>POST https://{{API_HOST}}/v1/event</code></p>
<h3 id='body'>Body</h3>
<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>callback_url</td>
<td>Domain Url mà tổng đài sẽ hook dữ liệu tới</td>
</tr>
<tr>
<td>callback_apikey</td>
<td>ApiKey hoặc access token của domain (optional)</td>
</tr>
<tr>
<td>event</td>
<td>SIP Call Event</td>
</tr>
</tbody></table>
<h3 id='sip-call-event'>SIP Call Event</h3>
<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>hangup</td>
<td>Sự kiện khi cuộc gọi bị ngắt, huỷ</td>
</tr>
<tr>
<td>ringing</td>
<td>Sự kiện khi cuộc gọi được khởi tạo</td>
</tr>
<tr>
<td>answered</td>
<td>Sự kiện khi cuộc gọi được nhấc máy</td>
</tr>
<tr>
<td>cdr</td>
<td>Sự kiện sau khi cdr được tạo xong</td>
</tr>
</tbody></table>

<aside class="danger">Nếu bạn tạo event nằm ngoài các event ở trên, hệ thống sẽ không nhận diện được nên sẽ không hook data về.</aside>

<aside class="warning">Nếu bạn cần hook event ngoài các event ở trên, vui lòng gửi mail hỗ trợ.</aside>
<h2 id='delete-event'>Delete Event</h2><div class="highlight"><pre class="highlight shell tab-shell"><code>curl <span class="nt">-L</span> <span class="nt">-X</span> DELETE <span class="s1">'https://{{API_HOST}}/v1/event/eeeeeeee-1111-2222-3333-eeeeeeee'</span> <span class="se">\</span>
<span class="nt">-H</span> <span class="s1">'Authorization: Bearer {{TOKEN}}'</span>
</code></pre></div>
<blockquote>
<p>Response trả về:</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"deleted"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>
<p>API dùng để xoá một event_domain.</p>
<h3 id='http-request-3'>HTTP Request</h3>
<p><code>DELETE https://{{API_HOST}}/v1/event/&lt;ID&gt;</code></p>
<h3 id='url-parameters'>URL Parameters</h3>
<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>ID</td>
<td>ID của event</td>
</tr>
</tbody></table>
<h2 id='event-hook-data'>Event Hook Data</h2>
<blockquote>
<p>Response trả về:</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"call_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"avavavav-1111-2222-3333-eeeeeeee"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"sip_call_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"dddddddd-1111-2222-3333-eeeeeeee"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"domain"</span><span class="p">:</span><span class="w"> </span><span class="s2">"test.tel4vn.com"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"direction"</span><span class="p">:</span><span class="w"> </span><span class="s2">"outbound"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"from_number"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0899888999"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"to_number"</span><span class="p">:</span><span class="w"> </span><span class="s2">"101"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"hotline"</span><span class="p">:</span><span class="w"> </span><span class="s2">"19001919"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"state"</span><span class="p">:</span><span class="w"> </span><span class="s2">"hangup"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"duration"</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w">
  </span><span class="nl">"billsec"</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w">
  </span><span class="nl">"recording_url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://recording.demo/ad4c9b90-c071-405a-9723-980d2e5e1623"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div><h3 id='description'>Description</h3>
<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>call_id</td>
<td>Id định danh cuộc gọi</td>
</tr>
<tr>
<td>sip_call_id</td>
<td>SIP Call Id</td>
</tr>
<tr>
<td>domain</td>
<td>Domain nhận hoặc thực hiện cuộc gọi</td>
</tr>
<tr>
<td>direction</td>
<td>Hướng cuộc gọi (inbound / outbound)</td>
</tr>
<tr>
<td>from_number</td>
<td>Số gọi. Sẽ là số ext nếu cuộc gọi là outbound</td>
</tr>
<tr>
<td>to_number</td>
<td>Số nhận. Sẽ là số ext nếu cuộc gọi là inbound</td>
</tr>
<tr>
<td>hotline</td>
<td>Đầu số nhận hoặc thực hiện cuộc gọi</td>
</tr>
<tr>
<td>state</td>
<td>ringing / answered / hangup / cdr</td>
</tr>
<tr>
<td>duration</td>
<td>Tổng thời lượng cuộc gọi. (Riêng sự kiện hangup)</td>
</tr>
<tr>
<td>billsec</td>
<td>Thời lượng tính từ khi hai bên kết nối. (Riêng sự kiện hangup)</td>
</tr>
<tr>
<td>recording_url</td>
<td>URL public để play file ghi âm. (Riêng sự kiện cdr)</td>
</tr>
</tbody></table>
<h2 id='note'>Note*</h2>
<p>Một số thông tin cần lưu ý khi tích hợp event:</p>

<ul>
<li>Event ringing, answered, hangup là các event theo luồng của một cuộc gọi.</li>
<li>Event cdr là event sẽ gửi tới webhook sau khi tổng đài cập nhật CDR.</li>
<li>Đối với các case outbound: call_id của các event sẽ map giống nhau do tồn tại trên một cuộc gọi.</li>
<li>ĐốI với các case inbound:

<ul>
<li>Trường hợp 1 mobile - 1 extension: call_id của các event sẽ map giống nhau do tồn tại trên một cuộc gọi.</li>
<li>Trường hợp 1 mobile - nhiều extension (Ringing, Queue, IVR): call_id của các event ringing, answered, hangup sẽ giống nhau. call_id của event cdr sẽ khác nhau. Do call_id của các event ringing, answered, hangup là call_id xử lý của cuộc gọi trên từng extension, call_id của event cdr là call_id của cả một luồng inbound (Ringing, Queue, IVR).</li>
</ul></li>
</ul>
